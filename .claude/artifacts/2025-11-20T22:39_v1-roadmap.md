---
created: 2025-11-20T22:39
prompt: "Create roadmap for getting to v1.0 release with focus on test stability, production cleanup, and practice workflow improvements"
---

# Rock-On v1.0 Roadmap

## Current State
- Deployed app running at rockon.band (mostly functional)
- 64 failing tests (8 test files), 491 passing tests
- Production contains debug artifacts (console logs, eruda, debug UI)
- Practice workflow needs improvement

## Goal
Clean, tested baseline ready for v1.0 release with polished practice workflow

---

## Phase 0: Foundation & Stability ⭐ CRITICAL - DO FIRST

**Goal:** Establish clean, testable baseline before any new work

### 1. Fix All Failing Tests
**Current Status:** 64 failing tests across 8 test files
- Unit tests: hooks/utils failures expected
- Integration tests: TBD after running full suite
- E2E tests: TBD

**Success Criteria:**
- ✅ All unit tests passing (100%)
- ✅ All integration tests passing
- ✅ All E2E tests passing
- ✅ All database tests passing (pgTAP)

**Deliverables:**
- All test files fixed
- Test output shows 0 failures
- Snapshot of working state

### 2. Add Tests to CI/CD Pipeline
**Dependencies:** Must complete after #1

**Implementation:**
- Add GitHub Actions workflow (or equivalent)
- Run on every push/PR:
  - `npm test` (unit + integration)
  - `npm run test:db` (pgTAP)
  - `npm run test:e2e` (Playwright)
- Block merge if any tests fail

**Success Criteria:**
- ✅ CI/CD runs automatically
- ✅ Cannot merge failing PRs
- ✅ Test results visible in PR

**Deliverables:**
- `.github/workflows/test.yml` (or equivalent)
- PR status checks enabled

---

## Phase 1: Infrastructure & Developer Experience

**Goal:** Proper testing environment and clean production code

### 3. Test Environment Deployment
**Dependencies:** Independent (can start after Phase 0)

**Implementation:**
- Deploy to `test.rockon.band` subdomain
- Set up separate Supabase project for test environment
- Configure environment variables:
  - `VITE_ENVIRONMENT=test`
  - Separate Supabase URL/anon key for test
- Document deployment process

**Success Criteria:**
- ✅ test.rockon.band accessible
- ✅ Isolated from production data
- ✅ Same functionality as prod
- ✅ Can test deployments before promoting to prod

**Deliverables:**
- Test environment deployed
- Documentation for deploying to test vs prod

### 4. Production Code Cleanup
**Dependencies:** Independent (can start after Phase 0)

**Scope:** Remove/gate debugging features for production

**Debug Features to Remove/Gate:**
- **Remove Entirely:**
  - Excessive console.log statements (keep critical errors only)
  - Debug UI on /band-members: "Database Integrated: This page is now connected to the database..."
  - Development-only comments and TODOs in UI

- **Gate Behind Dev Mode:**
  - Eruda console wheel (mobile debugging)
  - Verbose sync logging
  - Performance timing logs
  - Dev-only settings panel

**Implementation:**
- Create `src/config/environment.ts` with:
  ```typescript
  export const isDev = import.meta.env.MODE === 'development'
  export const isTest = import.meta.env.VITE_ENVIRONMENT === 'test'
  export const isProd = !isDev && !isTest
  ```
- Conditional rendering: `{isDev && <ErudaConsole />}`
- Replace console.log with proper logging util that respects env

**Success Criteria:**
- ✅ Production build has no debug UI
- ✅ Console logs minimal in production
- ✅ Dev mode still has full debugging tools
- ✅ No visible "Database Integrated..." messages in prod

**Deliverables:**
- Environment detection utility
- Cleaned production code
- Dev-gated debugging features

---

## Phase 2: User-Facing Features

**Goal:** Polish practice workflow and add settings

**Execution Order:** Practice workflow (high priority) → Settings page (quick win)

### 5. Practice Workflow Overhaul ⭐ HIGH PRIORITY
**Dependencies:** Must complete Phase 0 first

#### Database Changes (Pre-1.0: Modify Baseline)
**File:** `supabase/migrations/20251106000000_baseline_schema.sql`

**Changes:**
1. **Songs table - Repurpose notes column:**
   ```sql
   -- Rename 'notes' → 'markdown_structure'
   ALTER TABLE songs RENAME COLUMN notes TO markdown_structure;
   -- Update column comment
   COMMENT ON COLUMN songs.markdown_structure IS 'Markdown-formatted song structure (intro, verses, chorus, etc.)';
   ```

2. **Create practice_session_notes table:**
   ```sql
   CREATE TABLE practice_session_notes (
     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
     practice_session_id UUID NOT NULL REFERENCES practice_sessions(id) ON DELETE CASCADE,
     song_id UUID NOT NULL REFERENCES songs(id) ON DELETE CASCADE,
     notes TEXT NOT NULL,
     created_by UUID NOT NULL REFERENCES users(id),
     created_date TIMESTAMPTZ NOT NULL DEFAULT now(),
     version INTEGER NOT NULL DEFAULT 1,
     UNIQUE(practice_session_id, song_id)
   );

   -- Indexes
   CREATE INDEX idx_practice_session_notes_session ON practice_session_notes(practice_session_id);
   CREATE INDEX idx_practice_session_notes_song ON practice_session_notes(song_id);

   -- RLS policies
   ALTER TABLE practice_session_notes ENABLE ROW LEVEL SECURITY;
   -- (Add band isolation policies like other tables)
   ```

**Testing:**
- Test locally: `supabase db reset`
- Verify: `npm run test:db`

#### UI/UX Features

**A. Start Practice Flow**
- New "Start Practice" button on Practice page
- Modal to select songs for practice
- Creates practice_session record
- Navigates to practice mode view

**B. Practice Mode View**
- Setlist-style view of selected songs
- Current song highlighted
- Swipe/pan to next/previous song
- Exit practice button (returns to practice list)

**C. Song Detail in Practice Mode**
- Full-screen song view with:
  - Song metadata (title, artist, tempo, key)
  - Markdown-rendered song structure
  - Session notes input (tied to current practice)
  - "Next Song" / "Previous Song" navigation

**D. Markdown Renderer**
- Component: `SongStructureRenderer.tsx`
- Parse and render markdown from `markdown_structure` field
- Display formatted song structure (verses, chorus, bridge, etc.)

**E. Session Notes**
- Input field during practice mode
- Save notes tied to (practice_session_id, song_id)
- Display in practice history
- Display on song detail page ("Notes from previous practices")

**F. Historical Notes Viewing**
- Practice history page: show session notes per song
- Song detail page: show notes from all practice sessions

#### Success Criteria
- ✅ Can start practice session with selected songs
- ✅ Markdown structure renders correctly in practice mode
- ✅ Can add session notes to songs during practice
- ✅ Session notes persist and display in history
- ✅ Swipe/pan navigation works smoothly
- ✅ All E2E tests pass for practice workflow

#### Deliverables
- Updated baseline migration
- Start practice flow (UI + state management)
- Practice mode view with swipe navigation
- Markdown renderer component
- Session notes functionality
- E2E tests for practice workflow

---

### 6. Settings Page
**Dependencies:** Independent (quick win after Phase 0)

**Features:**
1. **Account Section** (Read-only)
   - Display: Email, name, user ID
   - No editing in v1.0

2. **Delete Account**
   - Button: "Delete Account"
   - Confirmation modal with warning
   - Calls Supabase auth delete endpoint
   - Logs user out after deletion

3. **Dev Mode Section** (Only visible in dev)
   - Toggle debug features
   - View sync logs
   - Clear local IndexedDB
   - Version info

**UI Layout:**
```
Settings
├─ Account
│  ├─ Email: user@example.com
│  ├─ Name: John Doe
│  └─ User ID: abc123...
├─ Data & Privacy
│  └─ [Delete Account] button
└─ Developer (dev-mode only)
   ├─ Debug Mode: [Toggle]
   ├─ [View Sync Logs]
   ├─ [Clear Local Data]
   └─ Version: 1.0.0
```

**Success Criteria:**
- ✅ Settings page accessible from nav
- ✅ Account info displays correctly
- ✅ Delete account flow works
- ✅ Dev section only visible in dev mode

**Deliverables:**
- Settings page component
- Delete account flow
- E2E test for settings page

---

## Dependencies & Execution Order

```
Phase 0 (Sequential - BLOCKING)
  ├─ 1. Fix all tests ← MUST COMPLETE FIRST
  └─ 2. Add CI/CD tests ← Depends on #1

Phase 1 (Parallel - Start after Phase 0)
  ├─ 3. Test environment ← Independent
  └─ 4. Production cleanup ← Independent

Phase 2 (After Phase 0 - Prioritized)
  ├─ 5. Practice workflow ← HIGH PRIORITY
  └─ 6. Settings page ← Quick win (can do anytime)
```

---

## Clarifications & Decisions

**Settings Page:**
- Read-only account info (no editing in v1.0)
- Delete account button included

**Songs Database:**
- Repurpose `notes` → `markdown_structure` (pre-1.0, no data to preserve)
- Modify baseline schema directly (no incremental migration)

**Practice Notes:**
- Tied to whole band (no private notes in v1.0)
- Private notes deferred to v2.0

**Priority:**
- Practice workflow is highest priority user-facing feature
- Settings page is quick win (can implement anytime)

---

## Next Steps

1. **Immediate:** Fix failing tests (Phase 0.1)
2. **User to do:** Work with other agents to create detailed specs for each phase
3. **After specs approved:** Begin implementation in priority order
