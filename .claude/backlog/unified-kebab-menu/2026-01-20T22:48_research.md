# Research: Unified KebabMenu Component

**Created:** 2026-01-20T22:48
**Status:** Backlog
**Priority:** Medium (UI Consistency)

## Problem Statement

The application has **5 distinct styling patterns** for kebab menus (three-dot action menus) across different pages and components. This inconsistency creates:

1. **Visual inconsistency** - Users see different button styles on different pages
2. **Mobile usability issues** - One pattern uses hover-only visibility which doesn't work on touch devices
3. **Maintenance burden** - Same menu logic duplicated 8+ times across the codebase
4. **Accessibility gaps** - Inconsistent keyboard handling and ARIA attributes

## Current State Analysis

### Pattern Matrix

| Pattern | Button Style      | Visibility         | Icon Size | Menu Width | Locations                      |
| ------- | ----------------- | ------------------ | --------- | ---------- | ------------------------------ |
| **A**   | Text-only         | Always             | 20px      | w-48       | SongsPage (table + cards)      |
| **B**   | Text-only         | Hover-only (fade)  | 18px      | w-40       | SongListItem (desktop)         |
| **C**   | Text-only         | Edit mode only     | 18px      | w-40       | SongListItem (mobile)          |
| **D**   | Rounded bg        | Always             | 18px      | w-40       | SetlistsPage, ShowsPage        |
| **E**   | Rounded bg + text | Always/Conditional | 16-20px   | w-48       | PracticesPage, BandMembersPage |

### Detailed Breakdown

#### Pattern A: Text-Only, Always Visible (SongsPage)

**Files:** `src/pages/SongsPage.tsx` (lines 568-622, 676-724)

```tsx
// Button
<button className="p-1 text-[#707070] hover:text-white transition-colors">
  <MoreVertical size={20} />
</button>

// Menu
<div className="absolute right-0 top-8 z-20 w-48 bg-[#1f1f1f] border border-[#2a2a2a] rounded-lg shadow-xl overflow-hidden">
```

**Characteristics:**

- No background on button
- Text color changes on hover (#707070 → white)
- Larger icon (20px)
- Wider menu (w-48)
- Menu uses `bg-[#1f1f1f]` (lighter)
- Has `overflow-hidden` on menu

---

#### Pattern B: Text-Only, Hover-Only Visibility (SongListItem Desktop)

**File:** `src/components/common/SongListItem.tsx` (lines 403-439)

```tsx
// Container with group hover
<div className="relative flex-shrink-0 opacity-0 group-hover:opacity-100 transition-all">
  <button className="p-1.5 text-[#707070] hover:text-white rounded transition-colors">
    <MoreVertical size={18} />
  </button>
</div>
```

**Characteristics:**

- **⚠️ NOT MOBILE FRIENDLY** - Hidden until hover
- Fades in via opacity transition
- No background on button
- Medium icon (18px)
- Requires parent `.group` class

---

#### Pattern C: Text-Only, Edit Mode Only (SongListItem Mobile)

**File:** `src/components/common/SongListItem.tsx` (lines 239-290)

```tsx
// Only renders when isEditing && (onEdit || onRemove)
<button className="p-1.5 text-[#707070] hover:text-white rounded transition-colors">
  <MoreVertical size={18} />
</button>
```

**Characteristics:**

- Conditional rendering based on edit mode
- Same styling as Pattern B but always visible when shown

---

#### Pattern D: Rounded Background on Hover (SetlistsPage, ShowsPage)

**Files:**

- `src/pages/SetlistsPage.tsx` (lines 595-656)
- `src/pages/ShowsPage.tsx` (lines 643-677)

```tsx
// Button
<button className="p-1.5 rounded-lg hover:bg-[#252525] transition-colors text-[#a0a0a0]">
  <MoreVertical size={18} />
</button>

// Menu
<div className="absolute right-0 top-8 w-40 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg shadow-lg z-20 py-1">
```

**Characteristics:**

- Rounded background appears on hover (`hover:bg-[#252525]`)
- No text color change on hover
- Default text color lighter (`#a0a0a0` vs `#707070`)
- Menu uses `bg-[#1a1a1a]` (darker)
- Has `py-1` padding on menu
- Menu item hover also uses `hover:bg-[#2a2a2a]` (SongsPage) or `hover:bg-[#252525]` (varies)

---

#### Pattern E: Rounded Background + Text Change (PracticesPage, BandMembersPage)

**Files:**

- `src/pages/PracticesPage.tsx` (lines 160-210)
- `src/pages/BandMembersPage.tsx` (lines 773-850, 889+)

```tsx
// PracticesPage
<button className="p-2 text-[#707070] hover:text-white hover:bg-[#252525] rounded-lg transition-colors">
  <MoreVertical size={20} />
</button>

// BandMembersPage
<button className="p-2 rounded-lg text-[#a0a0a0] hover:bg-[#2a2a2a] hover:text-white transition-colors">
  <MoreVertical size={16} />
</button>
```

**Characteristics:**

- Both background AND text color change on hover
- Larger padding (`p-2`)
- Icon size varies (16px vs 20px)
- BandMembersPage has conditional visibility based on user role

---

### Inconsistency Summary

| Property               | Variations                                       |
| ---------------------- | ------------------------------------------------ |
| **Icon size**          | 16px, 18px, 20px                                 |
| **Button padding**     | `p-1`, `p-1.5`, `p-2`                            |
| **Default text color** | `text-[#707070]`, `text-[#a0a0a0]`               |
| **Hover behavior**     | Text-only, bg-only, both                         |
| **Menu width**         | `w-40`, `w-48`                                   |
| **Menu background**    | `bg-[#1a1a1a]`, `bg-[#1f1f1f]`                   |
| **Menu shadow**        | `shadow-lg`, `shadow-xl`                         |
| **Menu item padding**  | `px-3 py-2`, `px-4 py-2`, `px-4 py-2.5`          |
| **Menu item hover**    | `hover:bg-[#2a2a2a]`, `hover:bg-[#252525]`       |
| **Delete text color**  | `text-[#D7263D]`, `text-red-400`, `text-red-500` |
| **Visibility**         | Always, hover-only, conditional, edit-mode       |
| **Overlay z-index**    | `z-10`, `z-40`                                   |
| **Menu z-index**       | `z-20`, `z-50`                                   |

---

## Recommended Approach

### Create Unified `KebabMenu` Component

**Location:** `src/components/common/KebabMenu.tsx`

### Proposed API

```tsx
interface KebabMenuProps {
  items: KebabMenuItem[]
  size?: 'sm' | 'md' | 'lg' // Controls icon size & padding
  visibility?: 'always' | 'hover' | 'conditional'
  isVisible?: boolean // For conditional visibility
  testIdPrefix?: string // For data-testid attributes
  className?: string // Additional button styling
}

interface KebabMenuItem {
  label: string
  icon?: React.ComponentType<{ size: number }>
  onClick: () => void
  variant?: 'default' | 'danger'
  disabled?: boolean
  testId?: string
}
```

### Standardized Styling

```tsx
// Button (recommended standard)
const buttonStyles = {
  base: 'rounded-lg transition-colors text-[#a0a0a0] hover:bg-[#252525] hover:text-white',
  sm: 'p-1.5', // 18px icon
  md: 'p-2', // 20px icon
  lg: 'p-2.5', // 22px icon
}

// Menu (recommended standard)
const menuStyles = {
  container:
    'absolute right-0 top-full mt-1 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg shadow-xl z-50 py-1 min-w-[10rem]',
  item: 'w-full px-4 py-2 text-left text-sm text-white hover:bg-[#2a2a2a] transition-colors flex items-center gap-2',
  itemDanger: 'text-red-500',
  separator: 'border-t border-[#2a2a2a] my-1',
}
```

### Design Decisions

| Decision               | Recommendation                | Rationale                             |
| ---------------------- | ----------------------------- | ------------------------------------- |
| **Default visibility** | Always visible                | Mobile-friendly, no touch issues      |
| **Hover style**        | Background + text             | More discoverable, clearer affordance |
| **Icon size**          | 18px default                  | Balance between visibility and space  |
| **Menu background**    | `bg-[#1a1a1a]`                | Darker for better contrast            |
| **Menu width**         | `min-w-[10rem]`               | Flexible, not fixed                   |
| **Z-index**            | Overlay: `z-40`, Menu: `z-50` | Consistent layering                   |
| **Delete color**       | `text-red-500`                | Matches Tailwind standard             |

---

## Files to Update

### Primary Implementation

- [ ] Create `src/components/common/KebabMenu.tsx`
- [ ] Create `tests/unit/components/common/KebabMenu.test.tsx`

### Migration (by page)

| File                                     | Component         | Lines            | Complexity |
| ---------------------------------------- | ----------------- | ---------------- | ---------- |
| `src/pages/SongsPage.tsx`                | SongRow, SongCard | 568-622, 676-724 | Medium     |
| `src/pages/SetlistsPage.tsx`             | SetlistCard       | 595-656          | Low        |
| `src/pages/ShowsPage.tsx`                | ShowCard          | 643-677          | Low        |
| `src/pages/PracticesPage.tsx`            | PracticeCard      | 160-210          | Low        |
| `src/pages/BandMembersPage.tsx`          | Desktop/Mobile    | 773-850, 889+    | Medium     |
| `src/components/common/SongListItem.tsx` | Desktop/Mobile    | 239-290, 403-439 | High       |

### Estimated Impact

- **8 component locations** need updates
- **~400 lines** of duplicated menu code to consolidate
- **6 files** affected

---

## Risk Assessment

| Risk                     | Level  | Mitigation                                  |
| ------------------------ | ------ | ------------------------------------------- |
| Visual regression        | Medium | Create Storybook stories, visual testing    |
| Broken click handlers    | Low    | Preserve existing handler signatures        |
| Accessibility regression | Low    | Add proper ARIA attributes in new component |
| Test breakage            | Medium | Update data-testid patterns consistently    |
| Mobile touch issues      | Low    | Test on actual devices                      |

---

## Open Questions

1. **Should hover-only visibility be supported at all?**
   - It's not mobile-friendly. Consider removing Pattern B entirely.

2. **Menu positioning strategy?**
   - Current: CSS `absolute` with manual positioning
   - Alternative: Use a positioning library like Floating UI for edge detection

3. **Keyboard navigation?**
   - Current: None
   - Should add: Arrow keys, Escape to close, Enter to select

4. **Focus management?**
   - Should focus return to button when menu closes?
   - Should first item be focused when menu opens?

---

## Success Criteria

- [ ] Single `KebabMenu` component used everywhere
- [ ] Consistent visual appearance across all pages
- [ ] Works correctly on mobile (touch-friendly)
- [ ] All existing E2E tests pass
- [ ] Keyboard accessible (Escape closes, Enter selects)
- [ ] Proper ARIA attributes (`aria-haspopup`, `aria-expanded`)

---

## Next Steps

When ready to implement:

1. Run `/plan unified-kebab-menu` to create implementation plan
2. Implement component with tests first (TDD)
3. Migrate one page at a time, running E2E tests after each
4. Update design system documentation

---

## References

- Current kebab locations audit (this document)
- Design style guide: `.claude/specifications/2025-10-22T14:01_design-style-guide.md`
- Testability standards in `CLAUDE.md`
